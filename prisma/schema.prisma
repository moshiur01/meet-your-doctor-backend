// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Specialization {
  id          String  @id @default(uuid())
  name        String
  description String? //optional field

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  //ref fields
  doctor Doctor[]
  // service Service[]

  @@map("specializations")
}

model Doctor {
  id       String  @id @default(uuid())
  email    String  @unique
  password String
  name     String  @map("name")
  phone    String? @unique @map("phone")
  photo    String? @default("https://png.pngtree.com/png-vector/20200408/ourlarge/pngtree-vector-design-of-young-doctor-with-stethoscope-png-image_2178293.jpg") @map("image_url")

  role   String  @default("doctor")
  gender String?

  education  String[]
  experience String[]
  bio        String?

  about String?

  avgRating Float @default(0) @map("avg_rating")

  totalRating Int @default(0) @map("total_Rating")

  isPasswordReset Boolean @default(false) @map("is_password_reset")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  //ref fields
  specializationId String         @map("specialization_id")
  specialization   Specialization @relation(fields: [specializationId], references: [id])

  timeSlots TimeSlot[]

  appointments Appointment[]

  @@map("doctors")
}

model TimeSlot {
  id String @id @default(uuid())

  startTime String @map("start_time")
  EndTime   String @map("end_time")
  day       String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  //ref fields
  doctorId String @map("doctor_id")
  doctor   Doctor @relation(fields: [doctorId], references: [id])

  //foreign
  doctorServices DoctorService[]

  appointments Appointment[]

  @@map("time_slots")
}

model DoctorService {
  id             String  @id @default(uuid())
  availableSeats Int     @map("available_seats")
  isBooked       Boolean @default(false) @map("is_booked")
  fees           String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  //ref fields
  doctorId String @map("doctor_id")
  // doctor   Doctor @relation(fields: [doctorId], references: [id])

  slotId String   @map("slot_id")
  slot   TimeSlot @relation(fields: [slotId], references: [id])

  appointments Appointment[]

  // @@unique([slotId, doctorId, slotDate, serviceId])
  @@map("doctor_services")
}

model Patient {
  id        String   @id @default(uuid())
  name      String   @map("name")
  email     String   @unique
  password  String
  role      String   @default("patient")
  gender    String
  photo     String?  @default("https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ2a4xxU0NG6NU0MrfhXkenFNvNMFScB1eDRokLNrMP8seq585qB4EKsddo-1_T6WDTu1g&usqp=CAU")
  bloodType String?
  phone     String   @unique @map("phone")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  appointment Appointment[]

  @@map("patients")
}

model Appointment {
  id              String @id @default(uuid())
  appointmentDate String @map("appointment_date")
  status          String @map("appointment_status")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  //ref fields
  patientId String  @map("patient_id")
  patient   Patient @relation(fields: [patientId], references: [id])

  doctorId String @map("doctor_id")
  doctor   Doctor @relation(fields: [doctorId], references: [id])

  doctorServiceId String        @map("doctor_service_id")
  doctorService   DoctorService @relation(fields: [doctorServiceId], references: [id])

  slotId   String   @map("slot_id")
  timeSlot TimeSlot @relation(fields: [slotId], references: [id])

  //foreign
  payment      Payment?
  medicine     Medicine?
  Prescription Prescription?

  @@map("appointments")
}

model Payment {
  id            String    @id @default(uuid())
  amount        String
  paymentDate   DateTime? @map("payment_date")
  paymentStatus String    @map("payment_status")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  //ref fields
  appointmentId String      @unique @map("appointment_id")
  appointment   Appointment @relation(fields: [appointmentId], references: [id])

  @@map("payments")
}

model Medicine {
  id     String @id @default(uuid())
  status String

  //ref fields
  appointmentId String      @unique @map("appointment_id")
  appointment   Appointment @relation(fields: [appointmentId], references: [id])

  @@map("medicines_for_patients")
}

model Prescription {
  id   String @id @default(uuid())
  link String

  //ref id
  appointmentId String      @unique @map("appointment_id")
  appointment   Appointment @relation(fields: [appointmentId], references: [id])

  @@map("patient_prescription")
}

model Admin {
  id              String  @id @default(uuid())
  fullName        String  @map("full_name")
  email           String  @unique
  phoneNumber     String  @unique
  photo           String  @default("https://www.shutterstock.com/image-vector/user-icon-vector-260nw-393536320.jpg")
  password        String
  role            String  @default("admin")
  isPasswordReset Boolean @default(true) @map("is_password_reset")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("admins")
}
